/**
 * grrd's Tic Tac Toe
 * Copyright (c) 2018 Gerard Tyedmers, grrd@gmx.net
 * @license MPL-2.0
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
!function(){"use strict";var e=0;const t=[{desc:"grrd's Tic Tac Toe is a HTML5 Game that works offline",players:"2 Players",easy:"Easy",medium:"Medium",hard:"Hard",instr:"Who is the first to get 3 fields in a line?",dev:"Developed by Gérard Tyedmers.",puzzle:"Have a look at my other games:",begin:"begins",play:"plays",win:"wins",draw:"draw",player:"Player",won:"has won!",score:"Score:",draw2:"This game ends in a draw."},{desc:"grrd's Tic Tac Toe ist ein HTML5 Spiel, welches offline funktioniert",players:"2 Spieler",easy:"Einfach",medium:"Mittel",hard:"Schwierig",instr:"Wer besetzt zuerst drei Felder in einer Linie?",dev:"Entwickelt von Gérard Tyedmers.",puzzle:"Schau dir auch meine anderen Spiele an:",begin:"beginnt",play:"spielt",win:"gewinnt",draw:"unentschieden",player:"Spieler",won:"hat gewonnen!",score:"Resultat:",draw2:"Diese Partie endet unentschieden."},{desc:"grrd's Tic Tac Toe est un jeu HTML5 qui fonctionne hors ligne",players:"2 Joueurs",easy:"Facile",medium:"Moyen",hard:"Dur",instr:"Qui est le premier à obtenir 3 champs dans une ligne?",dev:"Développé par Gérard Tyedmers.",puzzle:"Regardez aussi mes autres jeux:",begin:"commence",play:"joue",win:"gagne",draw:"nul",player:"Joueur",won:"a gagné!",score:"Résultat:",draw2:"Ce jeu se termine par un match nul."}];var n=Array.from(new Array(3),()=>new Array(3).fill(void 0));const o=document.getElementsByClassName("grid-item");var i,a,s,r=0,c=0,l=["human","human"],d=["x.svg","o.svg"],u=[0,0],p=!1,f=function(e){return document.getElementById(e)},m=f("iPopupInfo"),h=f("iPopupScore"),g=f("iTitle"),w=f("iGame"),v=f("iInfoBody"),y=f("iClose");function L(){const e=[[1,0],[0,1],[1,1],[1,-1]];var t=!1;return s=[],n.forEach(function(o,i){o.forEach(function(o,a){n[i][a]===r&&e.forEach(function(o,c){void 0!==n[i+e[c][0]]&&void 0!==n[i+2*e[c][0]]&&n[i+e[c][0]][a+e[c][1]]===r&&n[i+2*e[c][0]][a+2*e[c][1]]===r&&(s.push([i,a]),s.push([i+e[c][0],a+e[c][1]]),s.push([i+2*e[c][0],a+2*e[c][1]]),t=!0)})})}),t}function E(){var e,t,o=[[0,0,0],[0,0,0],[0,0,0]];const i=[0,1,2];return t=0,i.forEach(function(i,a){0===(e=[n[a][0],n[a][1],n[a][2]]).filter(e=>e===1-r).length&&(t=e.filter(e=>void 0===e).length+Math.pow(3*e.filter(e=>e===r).length,2),o[a][0]+=t,o[a][1]+=t,o[a][2]+=t)}),i.forEach(function(i,a){0===(e=[n[0][a],n[1][a],n[2][a]]).filter(e=>e===1-r).length&&(t=e.filter(e=>void 0===e).length+Math.pow(3*e.filter(e=>e===r).length,2),o[0][a]+=t,o[1][a]+=t,o[2][a]+=t)}),0===(e=[n[0][0],n[1][1],n[2][2]]).filter(e=>e===1-r).length&&(t=e.filter(e=>void 0===e).length+Math.pow(3*e.filter(e=>e===r).length,2),o[0][0]+=t,o[1][1]+=t,o[2][2]+=t),0===(e=[n[0][2],n[1][1],n[2][0]]).filter(e=>e===1-r).length&&(t=e.filter(e=>void 0===e).length+Math.pow(3*e.filter(e=>e===r).length,2),o[0][2]+=t,o[1][1]+=t,o[2][0]+=t),n.forEach(function(e,t){e.forEach(function(e,i){void 0!==n[t][i]&&(o[t][i]=void 0)})}),o}function T(){var e,t,o,i,a,s,c={nScore:-1,nRow:void 0,nCol:void 0},d=[],u=[],f=E();r=1-r;var m=E();r=1-r,n.forEach(function(e,t){e.forEach(function(e,o){void 0!==n[t][o]&&u.push({nPlayer:n[t][o],nRow:t,nCol:o})})}),3===u.length&&n[1][1]===r&&(n[0][0]===1-r&&n[2][2]===1-r&&(f[0][2]=0,f[2][0]=0,m[0][2]=0,m[2][0]=0),n[0][2]===1-r&&n[2][0]===1-r&&(f[0][0]=0,f[2][2]=0,m[0][0]=0,m[2][2]=0)),2===u.length&&n[1][1]===1-r&&(n[0][0]===r&&(f[2][2]=1e3),n[0][2]===r&&(f[2][0]=1e3),n[2][0]===r&&(f[0][2]=1e3),n[2][2]===r&&(f[0][0]=1e3)),"hard"===l[r]&&3===u.length&&n[1][1]===1-r&&(n[0][0]===r&&n[2][2]===1-r||n[0][2]===r&&n[2][0]===1-r||n[2][0]===r&&n[0][2]===1-r||n[2][2]===r&&n[0][0]===1-r)&&(f[0][1]=0,f[1][0]=0,f[1][2]=0,f[2][1]=0,m[0][1]=0,m[1][0]=0,m[1][2]=0,m[2][1]=0);var h=0;f.forEach(function(e){e.forEach(function(e){e>h&&(h=e)})}),m.forEach(function(e,t){e.forEach(function(e,n){void 0!==e&&(c.nScore=e>h&&h<37?e:f[t][n],c.nRow=t,c.nCol=n,d.push({nScore:c.nScore,nRow:t,nCol:n}))})}),d.sort(function(e,t){return t.nScore-e.nScore}),"human"!==l[r]&&(p=!0,setTimeout(function(){p=!1,"easy"===l[r]&&(e=1,e=Math.min(e,d.length-1)),"medium"===l[r]&&((e=Math.floor(3*Math.random()))>1&&(e-=1),e=Math.min(e,d.length-1)),"hard"===l[r]&&(e=0),t=d[0].nScore,i=d.filter(e=>e.nScore>=t).length,o=d.filter(e=>e.nScore<t).length>0?d.filter(e=>e.nScore<t)[0].nScore:t,a=d.filter(e=>e.nScore>=o).length,s=0===e?Math.floor(Math.random()*i):Math.floor(Math.random()*a),document.querySelectorAll("[data-row='"+d[s].nRow+"'][data-col='"+d[s].nCol+"']")[0].click()},500))}function A(e,t){for(var n=f("iMessage");n.firstChild;)n.removeChild(n.firstChild);void 0!==e&&((a=document.createElement("img")).setAttribute("src","images/"+d[e]),a.setAttribute("class","text-img"),n.appendChild(a)),n.innerHTML=n.innerHTML+t}function b(o){if("BUTTON"===o.target.nodeName&&!1===p){var i=o.target.getAttribute("data-row"),c=o.target.getAttribute("data-col");void 0!==n[i][c]||L()||(n[i][c]=r,(a=document.createElement("img")).setAttribute("class","svg-xo"),a.setAttribute("src","images/"+d[r]),o.target.appendChild(a),L()?(u[r]+=1,A(r," "+t[e].win),Array.from(document.getElementsByClassName("svg-xo")).forEach(function(e){e.classList.add("svg-xo-dimmed")}),Array.from(s).forEach(function(e){document.querySelectorAll("[data-row='"+e[0]+"'][data-col='"+e[1]+"'] > img")[0].classList.remove("svg-xo-dimmed"),document.querySelectorAll("[data-row='"+e[0]+"'][data-col='"+e[1]+"'] > img")[0].classList.add("svg-xo-highlight")}),f("iGameField").disabled=!0,h.getElementsByClassName("popup-content")[0].innerText=t[e].player+" "+(r+1)+" "+t[e].won,h.getElementsByClassName("popup-content")[1].innerText=t[e].score+" "+u[0]+" : "+u[1],h.classList.remove("popup-init"),h.classList.remove("popup-hide"),h.classList.add("popup-show-slow")):n.findIndex(e=>e.includes(void 0))<0?(A(void 0,t[e].draw),f("iGameField").disabled=!0,h.getElementsByClassName("popup-content")[0].innerText=t[e].draw2,h.getElementsByClassName("popup-content")[1].innerText=t[e].score+" "+u[0]+" : "+u[1],h.classList.remove("popup-init"),h.classList.remove("popup-hide"),h.classList.add("popup-show-draw")):(A(r=1-r," "+t[e].play),T()))}}function S(){Array.from(o).forEach(function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}),n.forEach(function(e,t){e.forEach(function(e,o){n[t][o]=void 0})}),f("iGameField").disabled=!1,h.classList.remove("popup-show-slow"),h.classList.remove("popup-show-draw"),h.classList.add("popup-hide"),r=c,c=1-c,A(r," "+t[e].begin),T()}function M(e){l[1]=e.target.getAttribute("data-payer2"),c=0,g.classList.remove("swipe-out-right"),w.classList.remove("swipe-in-left"),g.classList.add("swipe-out"),w.classList.add("swipe-in"),S()}function C(){S(),u=[0,0],g.classList.remove("swipe-out"),w.classList.remove("swipe-in"),g.classList.add("swipe-out-right"),w.classList.add("swipe-in-left")}function k(){f("iTitleField").disabled=!0,m.classList.remove("popup-init"),m.classList.remove("popup-hide"),m.classList.add("popup-show")}function x(){f("iTitleField").disabled=!1,m.classList.remove("popup-show"),m.classList.add("popup-hide")}document.onkeydown=function(e){const t=[f("iInfo"),f("i2Players"),f("iEasy"),f("iMedium"),f("iHard")],n=document.activeElement,o=t.indexOf(n),i=parseInt(n.getAttribute("data-row")),a=parseInt(n.getAttribute("data-col"));if(("ArrowUp"===e.key||"ArrowDown"===e.key||"ArrowLeft"===e.key||"ArrowRight"===e.key)&&n===document.getElementsByTagName("BODY")[0])return m.classList.contains("popup-show")?f("iInfoClose").focus():(h.classList.contains("popup-show")||h.classList.contains("popup-show-slow")||h.classList.contains("popup-show-draw"))&&f("iOK").focus(),void(w.classList.contains("swipe-in")?y.focus():t[0].focus());switch(e.key){case"ArrowUp":o>0&&t[t.indexOf(n)-1].focus(),i>0&&document.querySelectorAll("[data-row='"+(i-1)+"'][data-col='"+a+"']")[0].focus(),0===i&&y.focus();break;case"ArrowDown":o>-1&&o<t.length-1&&t[t.indexOf(n)+1].focus(),i<2&&document.querySelectorAll("[data-row='"+(i+1)+"'][data-col='"+a+"']")[0].focus(),n===y&&document.querySelectorAll("[data-row='0'][data-col='2']")[0].focus();break;case"ArrowLeft":o>0&&t[t.indexOf(n)-1].focus(),a>0&&document.querySelectorAll("[data-row='"+i+"'][data-col='"+(a-1)+"']")[0].focus(),0===i&&0===a&&y.focus();break;case"ArrowRight":o>-1&&o<t.length-1&&t[t.indexOf(n)+1].focus(),a<2&&document.querySelectorAll("[data-row='"+i+"'][data-col='"+(a+1)+"']")[0].focus(),n===y&&document.querySelectorAll("[data-row='0'][data-col='0']")[0].focus();break;case"Escape":m.classList.contains("popup-show")?x():h.classList.contains("popup-show")||h.classList.contains("popup-show-slow")||h.classList.contains("popup-show-draw")?S():w.classList.contains("swipe-in")&&C()}},function(){const a=(function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return null!==t&&t[1]}("lang")||navigator.language||navigator.browserLanguage||(navigator.languages||["en"])[0]).substring(0,2).toLowerCase();"de"===a?e=1:"fr"===a&&(e=2),e&&document.documentElement.setAttribute("lang",a),f("i2Players").getElementsByTagName("span")[0].innerHTML=t[e].players.replace(/\s/g," "),f("iEasy").getElementsByTagName("span")[0].innerHTML=t[e].easy,f("iMedium").getElementsByTagName("span")[0].innerHTML=t[e].medium,f("iHard").getElementsByTagName("span")[0].innerHTML=t[e].hard,v.getElementsByTagName("p")[0].innerHTML=t[e].instr,v.getElementsByTagName("p")[1].innerHTML=t[e].dev,f("iPuzzle").innerHTML=t[e].puzzle,document.querySelector("meta[name='description']").setAttribute("content",t[e].desc),"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("sw.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})}),n.forEach(function(e,t){e.forEach(function(e,n){(i=document.createElement("button")).className="grid-item",i.setAttribute("data-row",t.toString()),i.setAttribute("data-col",n.toString()),document.getElementsByClassName("grid-container")[0].appendChild(i)})}),f("iInfo").addEventListener("click",k),f("iInfoClose").addEventListener("click",x),Array.from(document.getElementsByClassName("list-button")).forEach(function(e){e.addEventListener("click",M)}),y.addEventListener("click",C),Array.from(o).forEach(function(e){e.addEventListener("click",b)}),f("iOK").addEventListener("click",S)}()}();