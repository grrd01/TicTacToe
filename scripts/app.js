/**
 * grrd's Tic Tac Toe
 * Copyright (c) 2018 Gerard Tyedmers, grrd@gmx.net
 * @license MPL-2.0
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
!function(){"use strict";var e=0;const t=[{desc:"grrd's Tic Tac Toe is a HTML5 Game that works offline",players:"2 Players",easy:"Easy",medium:"Medium",hard:"Hard",instr:"Who is the first to get 3 fields in a line?",dev:"Developed by Gérard Tyedmers.",puzzle:"Have a look at my other games:",begin:"begins",play:"plays",win:"wins",draw:"draw",player:"Player",won:"has won!",score:"Score:",draw2:"This game ends in a draw."},{desc:"grrd's Tic Tac Toe ist ein HTML5 Spiel, welches offline funktioniert",players:"2 Spieler",easy:"Einfach",medium:"Mittel",hard:"Schwierig",instr:"Wer besetzt zuerst drei Felder in einer Linie?",dev:"Entwickelt von Gérard Tyedmers.",puzzle:"Schau dir auch meine anderen Spiele an:",begin:"beginnt",play:"spielt",win:"gewinnt",draw:"unentschieden",player:"Spieler",won:"hat gewonnen!",score:"Resultat:",draw2:"Diese Partie endet unentschieden."},{desc:"grrd's Tic Tac Toe est un jeu HTML5 qui fonctionne hors ligne",players:"2 Joueurs",easy:"Facile",medium:"Moyen",hard:"Dur",instr:"Qui est le premier à obtenir 3 champs dans une ligne?",dev:"Développé par Gérard Tyedmers.",puzzle:"Regardez aussi mes autres jeux:",begin:"commence",play:"joue",win:"gagne",draw:"nul",player:"Joueur",won:"a gagné!",score:"Résultat:",draw2:"Ce jeu se termine par un match nul."}];var n=Array.from(new Array(3),()=>new Array(3).fill(void 0));const i=document.getElementsByClassName("grid-item");var r,o,a,s=0,c=0,l=["human","human"],d=["x.svg","o.svg"],u=[0,0],m=!1,p=function(e){return document.getElementById(e)},f=p("iPopupInfo"),g=p("iPopupScore"),h=p("iTitle"),v=p("iGame"),w=p("iInfoBody");function y(){const e=[[1,0],[0,1],[1,1],[1,-1]];var t=!1;return a=[],n.forEach(function(i,r){i.forEach(function(i,o){n[r][o]===s&&e.forEach(function(i,c){void 0!==n[r+e[c][0]]&&void 0!==n[r+2*e[c][0]]&&n[r+e[c][0]][o+e[c][1]]===s&&n[r+2*e[c][0]][o+2*e[c][1]]===s&&(a.push([r,o]),a.push([r+e[c][0],o+e[c][1]]),a.push([r+2*e[c][0],o+2*e[c][1]]),t=!0)})})}),t}function E(){var e,t,i=[[0,0,0],[0,0,0],[0,0,0]];const r=[0,1,2];return t=0,r.forEach(function(r,o){0===(e=[n[o][0],n[o][1],n[o][2]]).filter(e=>e===1-s).length&&(t=e.filter(e=>void 0===e).length+Math.pow(3*e.filter(e=>e===s).length,2),i[o][0]+=t,i[o][1]+=t,i[o][2]+=t)}),r.forEach(function(r,o){0===(e=[n[0][o],n[1][o],n[2][o]]).filter(e=>e===1-s).length&&(t=e.filter(e=>void 0===e).length+Math.pow(3*e.filter(e=>e===s).length,2),i[0][o]+=t,i[1][o]+=t,i[2][o]+=t)}),0===(e=[n[0][0],n[1][1],n[2][2]]).filter(e=>e===1-s).length&&(t=e.filter(e=>void 0===e).length+Math.pow(3*e.filter(e=>e===s).length,2),i[0][0]+=t,i[1][1]+=t,i[2][2]+=t),0===(e=[n[0][2],n[1][1],n[2][0]]).filter(e=>e===1-s).length&&(t=e.filter(e=>void 0===e).length+Math.pow(3*e.filter(e=>e===s).length,2),i[0][2]+=t,i[1][1]+=t,i[2][0]+=t),n.forEach(function(e,t){e.forEach(function(e,r){void 0!==n[t][r]&&(i[t][r]=void 0)})}),i}function L(){var e,t,i,r,o,a,c={nScore:-1,nRow:void 0,nCol:void 0},d=[],u=[],p=E();s=1-s;var f=E();s=1-s,n.forEach(function(e,t){e.forEach(function(e,i){void 0!==n[t][i]&&u.push({nPlayer:n[t][i],nRow:t,nCol:i})})}),3===u.length&&n[1][1]===s&&(n[0][0]===1-s&&n[2][2]===1-s&&(p[0][2]=0,p[2][0]=0,f[0][2]=0,f[2][0]=0),n[0][2]===1-s&&n[2][0]===1-s&&(p[0][0]=0,p[2][2]=0,f[0][0]=0,f[2][2]=0)),2===u.length&&n[1][1]===1-s&&(n[0][0]===s&&(p[2][2]=1e3),n[0][2]===s&&(p[2][0]=1e3),n[2][0]===s&&(p[0][2]=1e3),n[2][2]===s&&(p[0][0]=1e3)),"hard"===l[s]&&3===u.length&&n[1][1]===1-s&&(n[0][0]===s&&n[2][2]===1-s||n[0][2]===s&&n[2][0]===1-s||n[2][0]===s&&n[0][2]===1-s||n[2][2]===s&&n[0][0]===1-s)&&(p[0][1]=0,p[1][0]=0,p[1][2]=0,p[2][1]=0,f[0][1]=0,f[1][0]=0,f[1][2]=0,f[2][1]=0);var g=0;p.forEach(function(e){e.forEach(function(e){e>g&&(g=e)})}),f.forEach(function(e,t){e.forEach(function(e,n){void 0!==e&&(c.nScore=e>g&&g<37?e:p[t][n],c.nRow=t,c.nCol=n,d.push({nScore:c.nScore,nRow:t,nCol:n}))})}),d.sort(function(e,t){return t.nScore-e.nScore}),"human"!==l[s]&&(m=!0,setTimeout(function(){m=!1,"easy"===l[s]&&(e=1,e=Math.min(e,d.length-1)),"medium"===l[s]&&((e=Math.floor(3*Math.random()))>1&&(e-=1),e=Math.min(e,d.length-1)),"hard"===l[s]&&(e=0),t=d[0].nScore,r=d.filter(e=>e.nScore>=t).length,i=d.filter(e=>e.nScore<t).length>0?d.filter(e=>e.nScore<t)[0].nScore:t,o=d.filter(e=>e.nScore>=i).length,a=0===e?Math.floor(Math.random()*r):Math.floor(Math.random()*o),document.querySelectorAll("[data-row='"+d[a].nRow+"'][data-col='"+d[a].nCol+"']")[0].click()},500))}function T(e,t){for(var n=p("iMessage");n.firstChild;)n.removeChild(n.firstChild);void 0!==e&&((o=document.createElement("img")).setAttribute("src","images/"+d[e]),o.setAttribute("class","text-img"),n.appendChild(o)),n.innerHTML=n.innerHTML+t}function M(i){if("DIV"===i.target.nodeName&&!1===m){var r=i.target.getAttribute("data-row"),c=i.target.getAttribute("data-col");void 0!==n[r][c]||y()||(n[r][c]=s,(o=document.createElement("img")).setAttribute("class","svg-xo"),o.setAttribute("src","images/"+d[s]),i.target.appendChild(o),y()?(u[s]+=1,T(s," "+t[e].win),Array.from(document.getElementsByClassName("svg-xo")).forEach(function(e){e.classList.add("svg-xo-dimmed")}),Array.from(a).forEach(function(e){document.querySelectorAll("[data-row='"+e[0]+"'][data-col='"+e[1]+"'] > img")[0].classList.remove("svg-xo-dimmed"),document.querySelectorAll("[data-row='"+e[0]+"'][data-col='"+e[1]+"'] > img")[0].classList.add("svg-xo-highlight")}),g.getElementsByClassName("popup-content")[0].innerText=t[e].player+" "+(s+1)+" "+t[e].won,g.getElementsByClassName("popup-content")[1].innerText=t[e].score+" "+u[0]+" : "+u[1],g.classList.remove("popup-init"),g.classList.remove("popup-hide"),g.classList.add("popup-show-slow")):n.findIndex(e=>e.includes(void 0))<0?(T(void 0,t[e].draw),g.getElementsByClassName("popup-content")[0].innerText=t[e].draw2,g.getElementsByClassName("popup-content")[1].innerText=t[e].score+" "+u[0]+" : "+u[1],g.classList.remove("popup-init"),g.classList.remove("popup-hide"),g.classList.add("popup-show-draw")):(T(s=1-s," "+t[e].play),L()))}}function S(){Array.from(i).forEach(function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}),n.forEach(function(e,t){e.forEach(function(e,i){n[t][i]=void 0})}),g.classList.remove("popup-show-slow"),g.classList.remove("popup-show-draw"),g.classList.add("popup-hide"),s=c,c=1-c,T(s," "+t[e].begin),L()}function C(e){l[1]=e.target.getAttribute("data-payer2"),c=0,h.classList.remove("swipe-out-right"),v.classList.remove("swipe-in-left"),h.classList.add("swipe-out"),v.classList.add("swipe-in"),S()}function b(){S(),u=[0,0],h.classList.remove("swipe-out"),v.classList.remove("swipe-in"),h.classList.add("swipe-out-right"),v.classList.add("swipe-in-left")}function A(){f.classList.remove("popup-init"),f.classList.remove("popup-hide"),f.classList.add("popup-show")}function B(){f.classList.remove("popup-show"),f.classList.add("popup-hide")}!function(){const o=(function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return null!==t&&t[1]}("lang")||navigator.language||navigator.browserLanguage||(navigator.languages||["en"])[0]).substring(0,2).toLowerCase();"de"===o?e=1:"fr"===o&&(e=2),e&&document.documentElement.setAttribute("lang",o),p("i2Players").getElementsByTagName("div")[0].innerHTML=t[e].players.replace(/\s/g," "),p("iEasy").getElementsByTagName("div")[0].innerHTML=t[e].easy,p("iMedium").getElementsByTagName("div")[0].innerHTML=t[e].medium,p("iHard").getElementsByTagName("div")[0].innerHTML=t[e].hard,w.getElementsByTagName("p")[0].innerHTML=t[e].instr,w.getElementsByTagName("p")[1].innerHTML=t[e].dev,p("iPuzzle").innerHTML=t[e].puzzle,document.querySelector("meta[name='description']").setAttribute("content",t[e].desc),"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("sw.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})}),n.forEach(function(e,t){e.forEach(function(e,n){(r=document.createElement("div")).className="grid-item",r.setAttribute("data-row",t.toString()),r.setAttribute("data-col",n.toString()),document.getElementsByClassName("grid-container")[0].appendChild(r)})}),p("iInfo").addEventListener("click",A),p("iInfoClose").addEventListener("click",B),Array.from(document.getElementsByClassName("list-button")).forEach(function(e){e.addEventListener("click",C)}),p("iClose").addEventListener("click",b),Array.from(i).forEach(function(e){e.addEventListener("click",M)}),p("iOK").addEventListener("click",S)}()}();