/**
 * grrd's Tic Tac Toe
 * Copyright (c) 2018 Gerard Tyedmers, grrd@gmx.net
 * @license MPL-2.0
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
!function(){"use strict";var e=Array.from(new Array(3),()=>new Array(3).fill(void 0));const t=document.getElementsByClassName("grid-item");var o,n,i,r=0,c=0,a=["human","human"],s=["x.svg","o.svg"],l=[0,0],d=!1;function u(){const t=[[1,0],[0,1],[1,1],[1,-1]];var o=!1;return i=[],e.forEach(function(n,c){n.forEach(function(n,a){e[c][a]===r&&t.forEach(function(n,s){void 0!==e[c+t[s][0]]&&void 0!==e[c+2*t[s][0]]&&e[c+t[s][0]][a+t[s][1]]===r&&e[c+2*t[s][0]][a+2*t[s][1]]===r&&(i.push([c,a]),i.push([c+t[s][0],a+t[s][1]]),i.push([c+2*t[s][0],a+2*t[s][1]]),o=!0)})})}),o}function m(){var t,o,n=[[0,0,0],[0,0,0],[0,0,0]];const i=[0,1,2];return o=0,i.forEach(function(i,c){0===(t=[e[c][0],e[c][1],e[c][2]]).filter(e=>e===1-r).length&&(o=t.filter(e=>void 0===e).length+Math.pow(3*t.filter(e=>e===r).length,2),n[c][0]+=o,n[c][1]+=o,n[c][2]+=o)}),i.forEach(function(i,c){0===(t=[e[0][c],e[1][c],e[2][c]]).filter(e=>e===1-r).length&&(o=t.filter(e=>void 0===e).length+Math.pow(3*t.filter(e=>e===r).length,2),n[0][c]+=o,n[1][c]+=o,n[2][c]+=o)}),0===(t=[e[0][0],e[1][1],e[2][2]]).filter(e=>e===1-r).length&&(o=t.filter(e=>void 0===e).length+Math.pow(3*t.filter(e=>e===r).length,2),n[0][0]+=o,n[1][1]+=o,n[2][2]+=o),0===(t=[e[0][2],e[1][1],e[2][0]]).filter(e=>e===1-r).length&&(o=t.filter(e=>void 0===e).length+Math.pow(3*t.filter(e=>e===r).length,2),n[0][2]+=o,n[1][1]+=o,n[2][0]+=o),e.forEach(function(t,o){t.forEach(function(t,i){void 0!==e[o][i]&&(n[o][i]=void 0)})}),n}function f(){var t,o={nScore:-1,nRow:void 0,nCol:void 0},n=[],i=[],c=m();r=1-r;var s=m();r=1-r,e.forEach(function(t,o){t.forEach(function(t,n){void 0!==e[o][n]&&i.push({nPlayer:e[o][n],nRow:o,nCol:n})})}),3===i.length&&e[1][1]===r&&(e[0][0]===1-r&&e[2][2]===1-r&&(c[0][2]=0,c[2][0]=0,s[0][2]=0,s[2][0]=0),e[0][2]===1-r&&e[2][0]===1-r&&(c[0][0]=0,c[2][2]=0,s[0][0]=0,s[2][2]=0)),2===i.length&&e[1][1]===1-r&&(e[0][0]===r&&(c[2][2]=1e3),e[0][2]===r&&(c[2][0]=1e3),e[2][0]===r&&(c[0][2]=1e3),e[2][2]===r&&(c[0][0]=1e3));var l=0;c.forEach(function(e){e.forEach(function(e){e>l&&(l=e)})}),s.forEach(function(e,t){e.forEach(function(e,i){void 0!==e&&(o.nScore=e>l&&l<37?e:c[t][i],o.nRow=t,o.nCol=i,n.push({nScore:o.nScore,nRow:t,nCol:i}))})}),n.sort(function(e,t){return t.nScore-e.nScore}),d=!0,setTimeout(function(){d=!1,"easy"===a[r]&&(t=Math.min(Math.floor(3*Math.random()),n.length-1),document.querySelectorAll("[data-row='"+n[t].nRow+"'][data-col='"+n[t].nCol+"']")[0].click()),"medium"===a[r]&&(t=Math.min(Math.floor(2*Math.random()),n.length-1),document.querySelectorAll("[data-row='"+n[t].nRow+"'][data-col='"+n[t].nCol+"']")[0].click()),"hard"===a[r]&&document.querySelectorAll("[data-row='"+n[0].nRow+"'][data-col='"+n[0].nCol+"']")[0].click()},500)}function p(e,t){for(var o=document.getElementById("iMessage");o.firstChild;)o.removeChild(o.firstChild);void 0!==e&&((n=document.createElement("img")).setAttribute("src","images/"+s[e]),n.setAttribute("class","text-img"),o.appendChild(n)),o.innerHTML=o.innerHTML+t}function g(t){if("DIV"===t.target.nodeName&&!1===d){var o=t.target.getAttribute("data-row"),c=t.target.getAttribute("data-col");void 0!==e[o][c]||u()||(e[o][c]=r,(n=document.createElement("img")).setAttribute("class","svg-xo"),n.setAttribute("src","images/"+s[r]),t.target.appendChild(n),a=document.getElementById("iPopupScore"),u()?(l[r]+=1,p(r," wins"),Array.from(document.getElementsByClassName("svg-xo")).forEach(function(e){e.classList.add("svg-xo-dimmed")}),Array.from(i).forEach(function(e){document.querySelectorAll("[data-row='"+e[0]+"'][data-col='"+e[1]+"'] > img")[0].classList.remove("svg-xo-dimmed"),document.querySelectorAll("[data-row='"+e[0]+"'][data-col='"+e[1]+"'] > img")[0].classList.add("svg-xo-highlight")}),a.getElementsByClassName("popup-content")[0].innerText="Player "+(r+1)+" has won!",a.getElementsByClassName("popup-content")[1].innerText="Score: "+l[0]+" : "+l[1],a.classList.remove("popup-init"),a.classList.remove("popup-hide"),a.classList.add("popup-show-slow")):e.findIndex(e=>e.includes(void 0))<0?(p(void 0,"Draw"),a.getElementsByClassName("popup-content")[0].innerText="This game ends in a draw.",a.getElementsByClassName("popup-content")[1].innerText="Score: "+l[0]+" : "+l[1],a.classList.remove("popup-init"),a.classList.remove("popup-hide"),a.classList.add("popup-show-draw")):(p(r=1-r," plays"),f()))}var a}function h(){Array.from(t).forEach(function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}),e.forEach(function(t,o){t.forEach(function(t,n){e[o][n]=void 0})}),document.getElementById("iPopupScore").classList.remove("popup-show-slow"),document.getElementById("iPopupScore").classList.remove("popup-show-draw"),document.getElementById("iPopupScore").classList.add("popup-hide"),r=c,c=1-c,p(r," begins"),f()}function v(e){a[1]=e.target.getAttribute("data-payer2"),c=0,document.getElementById("iTitle").classList.remove("swipe-out-right"),document.getElementById("iGame").classList.remove("swipe-in-left"),document.getElementById("iTitle").classList.add("swipe-out"),document.getElementById("iGame").classList.add("swipe-in"),h()}function E(){h(),l=[0,0],document.getElementById("iTitle").classList.remove("swipe-out"),document.getElementById("iGame").classList.remove("swipe-in"),document.getElementById("iTitle").classList.add("swipe-out-right"),document.getElementById("iGame").classList.add("swipe-in-left")}function y(){document.getElementById("iPopupInfo").classList.remove("popup-init"),document.getElementById("iPopupInfo").classList.remove("popup-hide"),document.getElementById("iPopupInfo").classList.add("popup-show")}function w(){document.getElementById("iPopupInfo").classList.remove("popup-show"),document.getElementById("iPopupInfo").classList.add("popup-hide")}"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("sw.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})}),e.forEach(function(e,t){e.forEach(function(e,n){(o=document.createElement("div")).className="grid-item",o.setAttribute("data-row",t.toString()),o.setAttribute("data-col",n.toString()),document.getElementsByClassName("grid-container")[0].appendChild(o)})}),document.getElementById("iInfo").addEventListener("click",y),document.getElementById("iInfoClose").addEventListener("click",w),Array.from(document.getElementsByClassName("list-button")).forEach(function(e){e.addEventListener("click",v)}),document.getElementById("iClose").addEventListener("click",E),Array.from(t).forEach(function(e){e.addEventListener("click",g)}),document.getElementById("iOK").addEventListener("click",h)}();