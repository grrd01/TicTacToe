/**
 * grrd's Tic Tac Toe
 * Copyright (c) 2018 Gerard Tyedmers, grrd@gmx.net
 * @license MPL-2.0
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
!function(){"use strict";var e=Array.from(new Array(3),()=>new Array(3).fill(void 0));const t=document.getElementsByClassName("grid-item");var o,n,i,r=0,s=0,a=["human","human"],c=["x.svg","o.svg"],l=[0,0],d=!1;function u(){const t=[[1,0],[0,1],[1,1],[1,-1]];var o=!1;return i=[],e.forEach(function(n,s){n.forEach(function(n,a){e[s][a]===r&&t.forEach(function(n,c){void 0!==e[s+t[c][0]]&&void 0!==e[s+2*t[c][0]]&&e[s+t[c][0]][a+t[c][1]]===r&&e[s+2*t[c][0]][a+2*t[c][1]]===r&&(i.push([s,a]),i.push([s+t[c][0],a+t[c][1]]),i.push([s+2*t[c][0],a+2*t[c][1]]),o=!0)})})}),o}function m(){var t,o,n=[[0,0,0],[0,0,0],[0,0,0]];const i=[0,1,2];return o=0,i.forEach(function(i,s){0===(t=[e[s][0],e[s][1],e[s][2]]).filter(e=>e===1-r).length&&(o=t.filter(e=>void 0===e).length+Math.pow(3*t.filter(e=>e===r).length,2),n[s][0]+=o,n[s][1]+=o,n[s][2]+=o)}),i.forEach(function(i,s){0===(t=[e[0][s],e[1][s],e[2][s]]).filter(e=>e===1-r).length&&(o=t.filter(e=>void 0===e).length+Math.pow(3*t.filter(e=>e===r).length,2),n[0][s]+=o,n[1][s]+=o,n[2][s]+=o)}),0===(t=[e[0][0],e[1][1],e[2][2]]).filter(e=>e===1-r).length&&(o=t.filter(e=>void 0===e).length+Math.pow(3*t.filter(e=>e===r).length,2),n[0][0]+=o,n[1][1]+=o,n[2][2]+=o),0===(t=[e[0][2],e[1][1],e[2][0]]).filter(e=>e===1-r).length&&(o=t.filter(e=>void 0===e).length+Math.pow(3*t.filter(e=>e===r).length,2),n[0][2]+=o,n[1][1]+=o,n[2][0]+=o),e.forEach(function(t,o){t.forEach(function(t,i){void 0!==e[o][i]&&(n[o][i]=void 0)})}),n}function f(){var t,o,n,i,s,c,l={nScore:-1,nRow:void 0,nCol:void 0},u=[],f=[],p=m();r=1-r;var h=m();r=1-r,e.forEach(function(t,o){t.forEach(function(t,n){void 0!==e[o][n]&&f.push({nPlayer:e[o][n],nRow:o,nCol:n})})}),3===f.length&&e[1][1]===r&&(e[0][0]===1-r&&e[2][2]===1-r&&(p[0][2]=0,p[2][0]=0,h[0][2]=0,h[2][0]=0),e[0][2]===1-r&&e[2][0]===1-r&&(p[0][0]=0,p[2][2]=0,h[0][0]=0,h[2][2]=0)),2===f.length&&e[1][1]===1-r&&(e[0][0]===r&&(p[2][2]=1e3),e[0][2]===r&&(p[2][0]=1e3),e[2][0]===r&&(p[0][2]=1e3),e[2][2]===r&&(p[0][0]=1e3)),"hard"===a[r]&&3===f.length&&e[1][1]===1-r&&(e[0][0]===r&&e[2][2]===1-r||e[0][2]===r&&e[2][0]===1-r||e[2][0]===r&&e[0][2]===1-r||e[2][2]===r&&e[0][0]===1-r)&&(p[0][1]=0,p[1][0]=0,p[1][2]=0,p[2][1]=0,h[0][1]=0,h[1][0]=0,h[1][2]=0,h[2][1]=0);var g=0;p.forEach(function(e){e.forEach(function(e){e>g&&(g=e)})}),h.forEach(function(e,t){e.forEach(function(e,o){void 0!==e&&(l.nScore=e>g&&g<37?e:p[t][o],l.nRow=t,l.nCol=o,u.push({nScore:l.nScore,nRow:t,nCol:o}))})}),u.sort(function(e,t){return t.nScore-e.nScore}),"human"!==a[r]&&(d=!0,setTimeout(function(){d=!1,"easy"===a[r]&&(t=1,t=Math.min(t,u.length-1)),"medium"===a[r]&&((t=Math.floor(3*Math.random()))>1&&(t-=1),t=Math.min(t,u.length-1)),"hard"===a[r]&&(t=0),o=u[0].nScore,i=u.filter(e=>e.nScore>=o).length,n=u.filter(e=>e.nScore<o).length>0?u.filter(e=>e.nScore<o)[0].nScore:o,s=u.filter(e=>e.nScore>=n).length,c=0===t?Math.floor(Math.random()*i):Math.floor(Math.random()*s),document.querySelectorAll("[data-row='"+u[c].nRow+"'][data-col='"+u[c].nCol+"']")[0].click()},500))}function p(e,t){for(var o=document.getElementById("iMessage");o.firstChild;)o.removeChild(o.firstChild);void 0!==e&&((n=document.createElement("img")).setAttribute("src","images/"+c[e]),n.setAttribute("class","text-img"),o.appendChild(n)),o.innerHTML=o.innerHTML+t}function h(t){if("DIV"===t.target.nodeName&&!1===d){var o=t.target.getAttribute("data-row"),s=t.target.getAttribute("data-col");void 0!==e[o][s]||u()||(e[o][s]=r,(n=document.createElement("img")).setAttribute("class","svg-xo"),n.setAttribute("src","images/"+c[r]),t.target.appendChild(n),a=document.getElementById("iPopupScore"),u()?(l[r]+=1,p(r," wins"),Array.from(document.getElementsByClassName("svg-xo")).forEach(function(e){e.classList.add("svg-xo-dimmed")}),Array.from(i).forEach(function(e){document.querySelectorAll("[data-row='"+e[0]+"'][data-col='"+e[1]+"'] > img")[0].classList.remove("svg-xo-dimmed"),document.querySelectorAll("[data-row='"+e[0]+"'][data-col='"+e[1]+"'] > img")[0].classList.add("svg-xo-highlight")}),a.getElementsByClassName("popup-content")[0].innerText="Player "+(r+1)+" has won!",a.getElementsByClassName("popup-content")[1].innerText="Score: "+l[0]+" : "+l[1],a.classList.remove("popup-init"),a.classList.remove("popup-hide"),a.classList.add("popup-show-slow")):e.findIndex(e=>e.includes(void 0))<0?(p(void 0,"Draw"),a.getElementsByClassName("popup-content")[0].innerText="This game ends in a draw.",a.getElementsByClassName("popup-content")[1].innerText="Score: "+l[0]+" : "+l[1],a.classList.remove("popup-init"),a.classList.remove("popup-hide"),a.classList.add("popup-show-draw")):(p(r=1-r," plays"),f()))}var a}function g(){Array.from(t).forEach(function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}),e.forEach(function(t,o){t.forEach(function(t,n){e[o][n]=void 0})}),document.getElementById("iPopupScore").classList.remove("popup-show-slow"),document.getElementById("iPopupScore").classList.remove("popup-show-draw"),document.getElementById("iPopupScore").classList.add("popup-hide"),r=s,s=1-s,p(r," begins"),f()}function v(e){a[1]=e.target.getAttribute("data-payer2"),s=0,document.getElementById("iTitle").classList.remove("swipe-out-right"),document.getElementById("iGame").classList.remove("swipe-in-left"),document.getElementById("iTitle").classList.add("swipe-out"),document.getElementById("iGame").classList.add("swipe-in"),g()}function E(){g(),l=[0,0],document.getElementById("iTitle").classList.remove("swipe-out"),document.getElementById("iGame").classList.remove("swipe-in"),document.getElementById("iTitle").classList.add("swipe-out-right"),document.getElementById("iGame").classList.add("swipe-in-left")}function y(){document.getElementById("iPopupInfo").classList.remove("popup-init"),document.getElementById("iPopupInfo").classList.remove("popup-hide"),document.getElementById("iPopupInfo").classList.add("popup-show")}function w(){document.getElementById("iPopupInfo").classList.remove("popup-show"),document.getElementById("iPopupInfo").classList.add("popup-hide")}"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("sw.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})}),e.forEach(function(e,t){e.forEach(function(e,n){(o=document.createElement("div")).className="grid-item",o.setAttribute("data-row",t.toString()),o.setAttribute("data-col",n.toString()),document.getElementsByClassName("grid-container")[0].appendChild(o)})}),document.getElementById("iInfo").addEventListener("click",y),document.getElementById("iInfoClose").addEventListener("click",w),Array.from(document.getElementsByClassName("list-button")).forEach(function(e){e.addEventListener("click",v)}),document.getElementById("iClose").addEventListener("click",E),Array.from(t).forEach(function(e){e.addEventListener("click",h)}),document.getElementById("iOK").addEventListener("click",g)}();